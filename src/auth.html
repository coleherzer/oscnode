<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf-8">
    <title>Connect Citizenship</title>
    <script src="https://cdn.auth0.com/js/lock/11.0.1/lock.min.js"></script>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no" />
  </head>
  <body>
    <script>
      const { ipcRenderer } = require('electron')

      const AUTH0_CLIENT_ID = 'hUqNvY8l418NVyE0PHWZt3h4cu10BkYE'
      const AUTH0_DOMAIN = 'opensourcecitizen.auth0.com'
      const AUTH0_CALLBACK_URL = location.href

      const $ = document.querySelector.bind(document)

      const lock = new Auth0Lock(AUTH0_CLIENT_ID, AUTH0_DOMAIN, {
        auth: {
          redirect: false,
          sso: false
        }
      })

      lock.on('authenticated', function(authResult) {
        // {"accessToken":"-MufeS0ECKj9vB9oPhmrX2B27SAyUM9C","expiresIn":7200,"tokenType":"Bearer","state":"iXmNpUdRY32GTe6SJgFwmfVm4G4UfiBS"}
        lock.getUserInfo(authResult.accessToken, function(error, profile) {
          if (error) {
            alert(error)

            return
          }

          // {"sub":"github|3848","nickname":"motdotla","name":"Mot","picture":"https://avatars2.githubusercontent.com/u/3848?v=4","updated_at":"2018-02-10T19:09:21.463Z","email":"mot@mot.la","email_verified":true}
          ipcRenderer.send('auth-channel', profile)
        })
      })

      lock.show()
    </script>
  </body>
</html>
